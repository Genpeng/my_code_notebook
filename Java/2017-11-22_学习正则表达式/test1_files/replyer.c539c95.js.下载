;/*!question:widget/ask/replyer/replyer.js*/
define("question:widget/ask/replyer/replyer",function(e){function t(e){var t="1"===F.context("user").isLogin,i="1"===F.context("page").isAdopted,o=!!window.isQualityView,n="1"===F.context("newbest"),a=(F.context("page").supply,["该提问求助发自手机，请精简回答，方便查看","如最佳答案内容有误，欢迎提交正确答案。<br>让您的知识，帮到更多需要帮助的人...","提问者正在等待您的回答","请输入您的回答...","详细的问题说明，有助于回答者给出准确的答案","1.步骤类：①整体简介②所需工具/原料③方法/步骤④注意事项<br>2.常识类：①直接回答问题②详细给出具体原因/理由/介绍<br>3.原因类：①详细解释原因/理由②提供有效解决方案（构成见步骤类）<br>4.其他类型详见高质量标准（点击回答框右侧图片）"]),s="";s=n?a[1]:o?a[5]:t&&i?a[3]:a[2];var r=["fullscreen","bold","italic","paragraph","insertorderedlist","insertunorderedlist","blockquote","|","link","insertimage","insertvideo","map","template"];"74"===F.context("page").cidTop&&r.push("|","insertcode");var d=u.getEditor("answer-editor",{initialFrameWidth:"100%",initialFrameHeight:280,toolbars:[r],initialContent:e?e:s,maximumWords:9999,token:F.context("user").stoken});return d.iknowInit({isLogin:t,authcode:"new_reply",submitBtn:"提交回答",anonymouse:!0},function(e){e&&l(e).click(c)}),d}function i(){l(j.container).hasClass("iknow-editor-fullscreen")&&j&&j.submitBtn&&(j.submitBtn.style.display="none");var e=l(".layerBg"),t=l("#edui1"),i=t.width()-2,o=t.height()-2,n="height:"+o+"px;width:"+i+"px";if(e.length)e.attr("style",n).show();else{var a=l("<div style='"+n+"' class='layerBg'></div>"),s=l("<span class='loading-layer'></span>");t.append(a,s)}}function o(e,t){if(l(".loading-layer").hide(),l(".layerBg").hide(),l("."+e).length)l("."+e).show();else{var i=l("#edui1"),o=i.width()-2,n=(i.height()-2,l("<div class='tipLayer'></div>"));i.append(n);var a=l(".tipLayer");a.attr("class","tipLayer "+e).html("<span class='icon'></span><div>"+t+"</div>"),a.css("margin-left",(o-l(".tipLayer").width())/2+"px")}}function n(e){var t="",i=[],o=I.length;l(".loading-layer").hide(),l(".layerBg").hide(),o.length<=3?(l.each(I,function(e,i){t+=['<div class="visit-join-model-item">','<a target="_blank" href="/uteam/view?teamId='+i.teamId+'" class="visit-join-model-img"><img src="'+i.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+i.teamId+'">'+(i.teamName.length>7?i.teamName.slice(0,7):i.teamName)+"</a></h3>","<p><span>"+i.cname+"</span>"+i.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+i.teamId+'" class="visit-join-model-btn">加入</a></div>'].join("")}),i.push(t)):l.each(I,function(e,n){t+=['<div class="visit-join-model-item"><a target="_blank" href="/uteam/view?teamId='+n.teamId+'" class="visit-join-model-img"><img src="'+n.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+n.teamId+'">'+(n.teamName.length>7?n.teamName.slice(0,7):n.teamName)+"</a></h3>","<p><span>"+n.cname+"</span>"+n.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+n.teamId+'" class="visit-join-model-btn">加入</a></div>'].join(""),((e+1)%3===0&&0!==e||e===o-1)&&(i.push(t),t="")}),p.alert(O.html(),{className:"visit-join-model-wrap",title:"回答已提交",width:500,height:396,open:function(){var t,n,a=l("#visit-join-model-content");_||(_=new f({direction:"horizontal",controls:!1,activeIndex:0,items:i,interval:0}),_.render(a)),t=a.find(".visit-join-model-btn"),t.click(function(){var e=l(this);e.hasClass("visit-join-model-active")?e.removeClass("visit-join-model-active"):(t.removeClass("visit-join-model-active"),e.addClass("visit-join-model-active"))}),n=a.find(".visit-join-control"),3>=o?n.hide():n.click(function(){var e=l(this),t=e.data("action"),i=0,o=_.items.length;"left"===t?e.hasClass("visit-join-control-left-disable")||(_.prev(),i=_.getActiveIndex()-1,0>=i?e.addClass("visit-join-control-left-disable"):e.removeClass("visit-join-control-left-disable"),e.siblings().removeClass("visit-join-control-right-disable")):e.hasClass("visit-join-control-right-disable")||(_.next(),i=_.getActiveIndex()+1,i>=o-1?e.addClass("visit-join-control-right-disable"):e.removeClass("visit-join-control-right-disable"),e.siblings().removeClass("visit-join-control-left-disable"))}),l(".visit-join-model-wrap .ui-dialog-titlebar-close").click(function(){l.cookie.set("VISIT_VISIT_MODEL","show",{expires:31536e6,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){var t,i=l("#visit-join-model-content"),o=i.find(".visit-join-model-btn"),n=l("#visit-join-warn");o.each(function(){var e=l(this);return e.hasClass("visit-join-model-active")?(t=e,!0):void 0}),t?(l.post("/uteam/submit/applyJoin",{fr:"recalert",teamId:t.data("teamid")},function(t){"string"==typeof t&&(t=l.parseJSON(t)),p.close(),0!==t.errno?p.alert(t.errmsg,{className:"visit-join-model-error",open:function(){l(".visit-join-model-error .ui-dialog-titlebar-close").click(function(){l.cookie.set("VISIT_VISIT_MODEL","show",{expires:31536e6,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){l.cookie.set("VISIT_VISIT_MODEL","show",{expires:31536e6,path:"/"}),e&&e()}}]}):(l.cookie.set("VISIT_VISIT_MODEL","show",{expires:31536e6,path:"/"}),e&&e())}),h.send({module:"question",action:"visit-join",page:"unview",area:"join-alert"})):(n.animate({height:24}),setTimeout(function(){n.animate({height:0})},1e3))}}]}),h.send({module:"question",action:"visit-join",page:"unview",area:"alert"})}function a(e){h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsHatch:1});var t=w(l("#replyer-addtags-tmpl").html());l("body").append(t.render(e));var i=Number(v.get("showCount"))+1;v.set("showCount",i),l(".tags-box").on("click","li",function(){var e=l(this);e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")}),l(".addtags-box").on("click",".addtags-close",function(){l(".addtags-box").remove(),location.reload()}).on("click",".addtags-notip",function(){l(".addtags-box").remove(),h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsNotip:1}),v.set("addtagsHatch","notip"),location.reload()}).on("click",".addtags-sub",function(){var e=s();0===e.length?(h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",notAddtags:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()):(h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",hasAddtags:1}),l.ajax({url:"/submit/user",type:"post",dataType:"json",data:{cm:100522,tags:e,stoken:F.context("user").stoken}}).done(function(e){0===e.errorNo?setTimeout(function(){window.location="https://zhidao.baidu.com/ihome#body"},500):p.alert(e.errorMsg)}).fail(function(){p.alert("网络故障，请重试")}))})}function s(){var e=[];return l(".tags-box li").each(function(){var t=l(this);t.hasClass("selected")&&e.push(t.text())}),e.join("	")}function r(){h.addKey({subHatch:1});var e=w(l("#replyer-tags-tmpl").html());l("body").append(e.render()),v.set("subshowCount",Number(v.get("subshowCount"))+1),l(".tags-content").on("click",".tags-close",function(){l(".tags-box").remove(),location.reload()}).on("click",".tags-notip",function(){l(".tags-box").remove(),h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subaddtagsNotip:1}),v.set("skipHatch","notip"),location.reload()}).on("click",".tags-sub",function(){h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subHatchskip:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()})}function c(e){if(e.preventDefault(),!q){q=!0,setTimeout(function(){q=!1},1e3);var t={cm:100009,qid:F.context("page").qid,title:F.context("extra").title,answerfr:F.context("extra").answerfr,feedback:F.context("feedback"),entry:F.context("extra").entry};if(0==F.context("user").isNew&&0!=l.cookie.get("IK_FORCE_UHOME")&&l.cookie.set("IK_FORCE_UHOME","0",{expires:31536e6,path:"/"}),j.checkEditor()){var s=j.getEditorContent();t.co=s,t.cite="",t.rich=1,t.edit="new",j.authcode&&j.authcode.submitParam(t),j.anonymouse&&j.anonymouse.checked&&(t.anoy=1);var c="";t.co&&t.co.match(/<strong>/)&&t.co.match(/<em>/)?c="both":t.co&&t.co.match(/<strong>/)?c="replyBold":t.co&&t.co.match(/<em>/)&&(c="replyRed"),h.send({type:2014,page:"question",action:"answer",privilegeSubmit:c,uid:F.context("user").uid}),i(),m.fire("login.check",{isLogin:function(e){function i(){new g({params:t,hasJump:!1,syncId:"answer",jumpSubmitDelay:4500,beforeJump:function(e,t){function i(){l(".js-modal-usergrade").remove(),l(".js-usergrade-mask").remove(),v.set(s,"1"),document.body.style.overflow="initial",window.location.reload()}0==F.context("user").isNew&&0==F.context("user").isHaveCid&&l.ajax({type:"post",url:"/submit/user",data:{cm:100522,word:F.context("page").cid,stoken:F.context("user").stoken}});var s="IK_SHOW_MODAL_USERGRADE",c=new Date,d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate();if(v.get("SHOW_THANKS_GIVING_DIALOG")!==d){var u=new p({width:649,content:'<div class="thanks-giving-div"><i class="close"></i><a class="act-btn" href="http://zhidao.baidu.com/activity/commact?name=ganenjie" target="_blank"></a></div>',className:"thanks-giving-dialog",autoDispose:!0,open:function(){l(".thanks-giving-dialog .close").on("click",function(){u.close(),v.set("SHOW_THANKS_GIVING_DIALOG",d),window.location.reload()}),l(".thanks-giving-dialog .act-btn").on("click",function(){h.send({module:"question",page:"reply-question",area:"thanks-giving-dialog",action:"click"}),u.close(),v.set("SHOW_THANKS_GIVING_DIALOG",d),window.location.reload()}),h.send({module:"question",page:"reply-question",area:"thanks-giving-dialog",action:"pv"})}});v.set("SHOW_THANKS_GIVING_DIALOG",d)}else if("1"!==v.get(s)&&+F.context("user").gradeIndex>1){var s="IK_SHOW_MODAL_USERGRADE";document.body.style.overflow="hidden",l(document.body).append(l("#js-tmpl-usergrade-reset").html()),l(".js-modal-usergrade-comform").on("click",i),l(".js-modal-usergrade-close").on("click",i)}else if(I&&I.length&&"show"!==l.cookie.get("VISIT_VISIT_MODEL"))n(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true&newAnswer=1";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true&newAnswer=1"}else location.href=e+="?hideOtherAnswer=true&newAnswer=1"});else{v.get("showCount")||v.set("showCount",0),v.get("subshowCount")||v.set("subshowCount",0);var m=!F.context("user").tag&&"notip"!==v.get("addtagsHatch")&&v.get("showCount")<2,g=F.context("user").tag&&0!==F.context("user").tag.length&&"notip"!==v.get("skipHatch")&&v.get("subshowCount")<2;m&&"true"===F.context("isUnview")?l.ajax({url:"/misc/getrecommendtag",type:"post",dataType:"json",data:{qid:F.context("page").qid}}).done(function(e){0===e.error?a(e.data):p.alert(e.errorMsg)}).fail(function(){p.alert("网络故障，请重试")}):g&&"true"===F.context("isUnview")?r():(o("success-tip","您的回答已提交成功"),setTimeout(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true&newAnswer=1";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true&newAnswer=1"}else location.href=e+="?hideOtherAnswer=true&newAnswer=1"},2e3))}h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",rid:t.aid,qid:F.context("page").qid})},beforeError:function(){l(".loading-layer").hide(),l(".layerBg").hide()},authcode:j.authcode||null})}({tn:"ikqb",qid:F.context("page").qid,user:F.context("user").name,referrer:encodeURIComponent(document.referrer)});1===e.isRealName&&0===l("#passport-accRealName-pop").length?m.fire("login.realName",{onHide:function(){l(".loading-layer").hide(),l(".layerBg").hide()},onSubmitSuccess:function(){i()}}):1===e.isRealName&&l("#passport-accRealName-pop").length>0?(l("#passport-accRealName-pop").show(),l("body").children("div:first-child").show(),l("#passport-accRealName-pop").is(":hidden")?(l(".loading-layer").hide(),l(".layerBg").hide()):(l(".loading-layer").show(),l(".layerBg").show())):i()},noLogin:function(){m.fire("login.log",{onLoginSuccess:function(e){e&&(F.context("user").stoken=e.stoken),1===e.isRealName?(l(".loading-layer").hide(),l(".layerBg").hide()):new g({params:t,hasJump:!1,syncId:"answer",beforeJump:function(){I&&I.length&&"show"!==l.cookie.get("VISIT_VISIT_MODEL")?n(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true"}else location.href=e+="?hideOtherAnswer=true"}):(o("success-tip","您的回答已提交成功"),setTimeout(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true"}else location.href=e+="?hideOtherAnswer=true"},2e3))},beforeError:function(){l(".loading-layer").hide(),l(".layerBg").hide()},authcode:j.authcode||null})}})}})}}}function d(){if("1"===F.context("user").showfirstReplyTipModal){l(document.body).append(l("#js-tmpl-first-reply-reward").html());var e=l(".js-first-reply-reward-container"),t=setTimeout(function(){e.remove()},3e3);e.find(".iconfont-close").on("click",function(){clearTimeout(t),e.remove()})}}var l=e("common:widget/js/util/tangram/tangram"),u=e("common:widget/js/logic/ueditor/ueditor"),h=e("common:widget/js/util/log/log"),m=e("common:widget/js/util/event/event"),g=e("common:widget/js/logic/submit/submit"),p=e("common:widget/js/ui/dialog/dialog"),f=e("common:widget/js/ui/carousel/carousel"),w=e("common:widget/lib/juicer/juicer"),v=e("common:widget/js/util/store/store"),b=e("question:widget/ask/editor-guide/editor-guide");e("question:widget/js/app-guide/app-guide");var y=l("#answer-bar"),x=l("#answer-bar i").get(0),k={ql:/browse(?:\/\d+(?:$|\?lm=2|\?[^lm])|$|\/$|\/\?lm=2)/i,ql_tab_hscore:/browse\/\d*\?lm\=4/,ql_tab_zero:/browse\/\d*\?lm\=8/,ql_tab_emergency:/browse\/\d*\?lm\=16/,zhuanti:/zhidao\.baidu\.com\/s\/([a-zA-Z0-9_\-]+)/,search:/zhidao\.baidu\.com\/search/};!function(){var e,t=document.referrer,i="";for(var o in k)if(e=t.match(k[o])){i=o;break}if(i&&"zhuanti"==i&&(i=e[1]),!i){var n=l.url.queryToJson(location.search||"");n&&"uc_push"==n.fr&&(i="keyword"==n.push?"uc_tab_keyword":"category"==n.push?"uc_tab_class":"uc_tab_recommand")}var a=F.context("page").isFromWap,s=i+(parseInt(a)?";wap_question_replyed":"");F.context("extra",{title:s,answerfr:s})}();var j=null;y.click(function(){var e=l(this).text();h.send({module:"question",action:"click",page:"replyer",area:"have-better-answer-btn",btn_type:e,isLogin:"1"===F.context("user").isLogin?1:0}),m.fire("login.check",{isLogin:function(){j=j||t(),"i-incline-down"===x.className?(j.expandEditor(function(e){e.style.overflow="inherit",l("#answer-editor").css({visibility:"inherit"})}),x.className="i-incline-up",l(".wgt-search-relate, .search-relate").show(),d()):(j.collapseEditor(function(e){e.style.overflow="hidden",l("#answer-editor").css({visibility:"hidden"})}),x.className="i-incline-down",l(".wgt-search-relate, .search-relate").hide())},noLogin:function(){m.fire("login.log",{onLoginSuccess:function(){window.location.reload()}})}})}),function(){var e={home:/zhidao\.baidu\.com\/$/,browse:/zhidao\.baidu\.com\/browse/,ihome:/zhidao\.baidu\.com\/ihome(?!\/hangjia)/,qb:/zhidao\.baidu\.com\/question/,hangjia:/zhidao\.baidu\.com\/ihome\/hangjia\/index/,team:/zhidao\.baidu\.com\/team/},t=location.href,i=document.referrer,o=l.url.getQueryValue(t,"entry")||"";if(""==o){for(var n in e)if(i.match(e[n])){o="qb_"+n+"_none";break}o=""==o?"qb_none_none":o}F.context("extra").entry=o}();var _=null,I=F.context("visitJoin"),O=l("#visit-join-model-template"),q=!1;!function(){if(F.context("page").relatedKeyword)return void window.isQualityView;l("<a/>").html("<span></span>搜索相关资料").addClass("mb-5 mt-15 search-relate").attr("href","http://www.baidu.com/s?wd="+encodeURIComponent(F.context("page").title)+"&ie=utf-8").attr("target","_blank").hide().insertBefore("#answer-bar")}(),("1"!=F.context("page").isView||"1"==F.context("isForAnswerHq")||"1"==F.context("isForceAnswer"))&&l(function(){j=j||t(b.content),b(j),j.addListener("ready",j.expandEditor),d(),l(".wgt-search-relate, .search-relate").show(),y.hide()})});